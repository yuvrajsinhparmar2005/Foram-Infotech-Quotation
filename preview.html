<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Preview Quotation</title>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans:wght@400;600;700;800&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/icon?family=Material+Icons" rel="stylesheet">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>

    <style>
        body { background: #525659; font-family: 'Noto Sans', sans-serif; margin: 0; padding: 20px; display: flex; flex-direction: column; align-items: center; }
        .controls { position: sticky; top: 20px; z-index: 100; background: white; padding: 10px 20px; border-radius: 50px; box-shadow: 0 4px 10px rgba(0,0,0,0.3); display: flex; gap: 15px; margin-bottom: 20px; }
        .btn { padding: 8px 20px; border-radius: 20px; border: none; font-weight: 700; cursor: pointer; display: flex; align-items: center; gap: 5px; text-decoration: none; color: #333; font-size: 0.9rem; }
        .btn-download { background: #10b981; color: white; }
        .btn-back { background: #0062ff; color: white; }

        #invoice { width: 210mm; min-height: 297mm; background: white; box-shadow: 0 0 20px rgba(0,0,0,0.5); box-sizing: border-box; position: relative; color: #000; overflow: hidden; }

        /* --- THEME 1: FORAM (Classic) --- */
        .theme-foram { padding: 40px; }
        .theme-foram .header { display: flex; justify-content: space-between; border-bottom: 2px solid #0062ff; padding-bottom: 10px; margin-bottom: 20px; }
        .theme-foram .bottom-bar { position: absolute; bottom: 30px; left: 40px; right: 40px; border-top: 2px solid #0062ff; padding-top: 10px; text-align: center; font-size: 10px; }

        /* --- THEME 2: ABC (Modern Sidebar) --- */
        .theme-abc { padding: 0; display: flex; flex-direction: column; }
        .theme-abc .top-stripe { height: 15px; background: #dc2626; width: 100%; }
        .theme-abc .content-padding { padding: 40px; }
        .theme-abc .header { display: flex; background: #f8fafc; padding: 30px 40px; justify-content: space-between; align-items: center; border-bottom: 1px solid #ddd; }
        .theme-abc .tbl th { background: #334155; color: white; border: none; }

        /* --- THEME 3: XYZ (Corporate Bold) --- */
        .theme-xyz { padding: 0; }
        .theme-xyz .corp-header { background: #0d9488; color: white; padding: 50px 40px; display: flex; justify-content: space-between; }
        .theme-xyz .corp-header h1 { color: white !important; margin: 0; font-size: 35px; }
        .theme-xyz .content-padding { padding: 40px; }
        .theme-xyz .tbl th { background: #f0fdfa; color: #0d9488; border: 1px solid #0d9488; }

        /* Shared Table Styles */
        .tbl { width: 100%; border-collapse: collapse; font-size: 12px; margin-top: 20px; }
        .tbl th, .tbl td { border: 1px solid #ddd; padding: 10px; }
        .text-right { text-align: right; }
        .text-center { text-align: center; }
        .hidden { display: none !important; }
        .footer-flex { display: flex; justify-content: space-between; margin-top: 30px; }
    </style>
</head>
<body>

    <div class="controls">
        <a href="#" id="btn-edit" class="btn"><span class="material-icons">edit</span> Edit</a>
        <button class="btn btn-download" onclick="downloadPDF()"><span class="material-icons">download</span> Download PDF</button>
        <a href="index.html" class="btn btn-back"><span class="material-icons">arrow_back</span> Back</a>
    </div>

    <div id="invoice">
        <div id="dynamic-container">
            </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const urlParams = new URLSearchParams(window.location.search);
            const id = urlParams.get('id');
            const q = (JSON.parse(localStorage.getItem('myQuotations')) || []).find(item => item.id == id);
            if(!q) return;

            document.getElementById('btn-edit').href = `quotation.html?id=${id}`;
            const container = document.getElementById('dynamic-container');
            const invoice = document.getElementById('invoice');

            let htmlContent = '';

            if (q.company === "ABC Corp") {
                invoice.className = "theme-abc";
                htmlContent = `
                    <div class="top-stripe"></div>
                    <div class="header">
                        <div><h1 style="margin:0; color:#dc2626;">ABC CORP</h1><p>Innovation at Work</p></div>
                        <div class="text-right"><strong>QUOTATION</strong><br># ${q.quoteNo}</div>
                    </div>
                    <div class="content-padding">
                        <div class="footer-flex">
                            <div><strong>BILL TO:</strong><br>${q.client}<br>${q.addr1}<br>${q.addr2}</div>
                            <div class="text-right"><strong>DATE:</strong> ${q.issueDate}<br><strong>VALID:</strong> ${q.validDate}</div>
                        </div>
                        ${generateTable(q)}
                        <div class="footer-flex">
                            <div style="font-size:11px;"><strong>BANK:</strong> ICICI Bank | <strong>A/C:</strong> 123456789</div>
                            <div class="text-right" style="width:200px;"><br><br><div style="border-top:1px solid #000; padding-top:5px;">Authorized Signatory</div></div>
                        </div>
                    </div>
                `;
            } 
            else if (q.company === "XYZ Solutions") {
                invoice.className = "theme-xyz";
                htmlContent = `
                    <div class="corp-header">
                        <div><h1>XYZ</h1><p>SOLUTIONS LTD</p></div>
                        <div class="text-right">QUOTATION NO<br><span style="font-size:20px;">${q.quoteNo}</span></div>
                    </div>
                    <div class="content-padding">
                        <div class="footer-flex" style="margin-bottom:40px;">
                            <div style="border-left:5px solid #0d9488; padding-left:15px;">
                                <strong>CLIENT DETAILS</strong><br>${q.client}<br>${q.addr1}
                            </div>
                            <div class="text-right">Date: ${q.issueDate}</div>
                        </div>
                        ${generateTable(q)}
                        <div class="footer-flex">
                            <div style="background:#f8fafc; padding:15px; width:60%;">
                                <strong>Bank Transfer Details</strong><br>Axis Bank | IFSC: UTIB0001 | A/C: 998877
                            </div>
                            <div class="text-right">For XYZ Solutions<br><br><br><strong>Manager Sig.</strong></div>
                        </div>
                    </div>
                `;
            } 
            else {
                invoice.className = "theme-foram";
                htmlContent = `
                    <div class="header">
                        <div><img src="Foram-logo.jpg" style="width:100px;"></div>
                        <div class="text-right"><h1 style="color:#0062ff; margin:0;">FORAM INFOTECH</h1><p>Sales & Service</p></div>
                    </div>
                    <div>
                        <strong>To,</strong><br>${q.client}<br>${q.addr1}<br>${q.addr2}
                        <div class="text-right" style="margin-top:-40px;">
                            Quote: ${q.quoteNo}<br>Date: ${q.issueDate}
                        </div>
                    </div>
                    ${generateTable(q)}
                    <div class="footer-flex">
                        <div style="border:1px solid #000; padding:10px; width:50%; font-size:11px;">
                            <strong>Bank Details:</strong> HDFC Bank | A/C: 50200113927631
                        </div>
                        <div class="text-right">for Foram Infotech<br><br><br>Auth. Signatory</div>
                    </div>
                    <div class="bottom-bar">Shop 137, Ratnadeep Flora, New Ranip, Ahmedabad | 88666 23434</div>
                `;
            }

            container.innerHTML = htmlContent;
        });

        function generateTable(q) {
            let rows = q.items.map(item => `
                <tr>
                    <td>${item.desc}</td>
                    <td class="text-center">${item.qty}</td>
                    <td class="text-right">${item.price}</td>
                    <td class="text-center">${item.warr}</td>
                    <td class="text-right">${item.total}</td>
                </tr>
            `).join('');

            return `
                <table class="tbl">
                    <thead><tr><th>Description</th><th>Qty</th><th>Price</th><th>Warranty</th><th>Total</th></tr></thead>
                    <tbody>${rows}</tbody>
                    <tfoot>
                        <tr><td colspan="4" class="text-right"><strong>Grand Total</strong></td><td class="text-right"><strong>${q.grandTotal}</strong></td></tr>
                    </tfoot>
                </table>
                <p style="font-size:11px; margin-top:10px;"><strong>Words:</strong> ${q.amountWords}</p>
            `;
        }

        function downloadPDF() {
            const element = document.getElementById('invoice');
            html2pdf().set({ margin: 0, filename: 'Quotation.pdf', html2canvas: { scale: 2 }, jsPDF: { unit: 'mm', format: 'a4' }}).from(element).save();
        }
    </script>
</body>
</html>
